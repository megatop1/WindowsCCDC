Import-Module ActiveDirectory
Import-Module GroupPolicy 

#The below is the name of the domain, rj, com
$domainName = 
$beforeDot = 
$AfterDot =

#Disable CMD for regular users 
New-GPO -name "DisableCMD" -domain "rj.com"
Set-GPRegistryValue -name "DisableCMD" -key "HKCU\Software\Policies\Microsoft\Windows\System" -ValueName "DisableCMD" -type Dword -value 00000002
New-GPLink -name "DisableCMD" -Target "dc=rj,dc=com" -LinkEnabled Yes 

#Disable access to registry and editing reg keys 
New-GPO -name "DisableRegAccess" -domain "rj.com"
Set-GPRegistryValue -name "DisableRegAccess" -key "HKCU\Software\Microsoft\Windows\CurrentVersion\Policies\System" -ValueName "DisableRegistryTools" -type Dword -value 00000002
New-GPLink -name "DisableRegAccess" -Target "dc=rj,dc=com" -LinkEnabled Yes 

#Disable LLMNR
New-GPO -name "DisableLLMNR" -domain "rj.com"
Set-GPRegistryValue -name "DisableLLMNR" -key "HKLM\Software\Policies\Microsoft\Windows NT\DNSClient" -ValueName "EnableMulticast" -type Dword -value 0000000
New-GPLink -name "DisableLLMNR" -Target "dc=rj,dc=com" -LinkEnabled Yes

#Disable RDP (CHECK IF RDP IS SCORED?!?!?!)
New-GPO -name "DisableRDP" -domain "rj.com"
Set-GPRegistryValue -name "DisableRDP" -key "HKLM\Software\Policies\Microsoft\Windows NT\Terminal Services" -ValueName "fDenyTSConnections" -type Dword -value 00000001
New-GPLink -name "DisableLLMNR" -Target "dc=rj,dc=com" -LinkEnabled Yes

#Disable forced system restarts after updates
New-GPO -name "DisableRestarts" -domain "rj.com"
Set-GPRegistryValue -name "DisableRestarts" -key "HKLM\Software\Policies\Microsoft\Windows\WindowsUpdate\AU" -ValueName "NoAutoRebootWithLoggedOnUsers" -type Dword -value 00000001
New-GPLink -name "DisableRestarts" -Target "dc=rj,dc=com" -LinkEnabled Yes

#Prohibit tasks being started\stopped
New-GPO -name "DisableTaskCreation" -domain "rj.com"
Set-GPRegistryValue -name "DisableTaskCreation" -key "HKLM\Software\Policies\Microsoft\Windows\Task Scheduler5.0" -ValueName "Execution" -type Dword -value 00000004
New-GPLink -name "DisableTaskCreation" -Target "dc=rj,dc=com" -LinkEnabled Yes

#PowerShell Execution Policy to local scripts and signed trusted scripts to execute (Currently not working)
New-GPO -name "PowershellExecution" -domain "rj.com"
Set-GPRegistryValue -name "PowershellExecution" -key "HKCU\Software\Policies\Microsoft\Windows\PowerShell" -ValueName "Execution Policy" -type string -value RemoteSigned
New-GPLink -name "PowershellExecution" -Target "dc=rj,dc=com" -LinkEnabled Yes

#Configure APPlocker 
import-module applocker
